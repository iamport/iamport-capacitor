{"version":3,"file":"plugin.cjs.js","sources":["esm/plugin.js","esm/index.js","esm/web.js"],"sourcesContent":["// import { Device } from '@capacitor/device';\nimport { Capacitor } from '@capacitor/core';\nimport queryString from 'query-string';\nimport { IamportCapacitor } from './index';\n// const REDIRECT_URL = 'http://localhost/iamport';\nconst REDIRECT_URL = 'http://detectchangingwebview/iamport/capacitor';\nexport class IMP {\n    constructor() {\n        this.isCallbackCalled = false;\n        this.triggerCallback = `function(response) {\n      const query = [];\n      Object.keys(response).forEach(key => {\n        query.push(key + '=' + response[key]);\n      });\n\n      location.href = 'http://detectchangingwebview/iamport/capacitor?' + query.join('&');\n    }`;\n    }\n    addListenerInner(callback, callbackOnBack, type) {\n        IamportCapacitor.addListener('IMPOver', async ({ url }) => {\n            if (!this.isCallbackCalled) { // 콜백 중복 호출 방지\n                // const { platform } = await Device.getInfo();\n                const platform = Capacitor.getPlatform();\n                if (platform === 'ios' && type === 'inicis') {\n                    /**\n                     * IOS && 이니시스 && 실시간 계좌이체 예외처리\n                     * 리디렉션 URL: io.ionic.starter://?imp_uid=imp_048747651691%26merchant_uid=mid_1573712730635%26m_redirect_url=http%3A%2F%2Flocalhost%2Fiamport%3Fimp_uid%3Dimp_048747651691%26merchant_uid%3Dmid_15737127306352\n                    */\n                    const decodedUrl = decodeURIComponent(url);\n                    const extractedQuery = queryString.extract(decodedUrl);\n                    const parsedQuery = queryString.parse(extractedQuery);\n                    const { imp_uid, merchant_uid } = parsedQuery;\n                    const success = \"true\";\n                    const query = {\n                        success,\n                        imp_uid,\n                        merchant_uid: typeof merchant_uid === 'object'\n                            ? merchant_uid === null || merchant_uid === void 0 ? void 0 : merchant_uid[0]\n                            : merchant_uid,\n                    };\n                    callback(query);\n                }\n                else {\n                    const { query } = queryString.parseUrl(url);\n                    callback(query);\n                }\n                this.isCallbackCalled = true;\n            }\n        });\n        IamportCapacitor.addListener('IMPBack', async () => {\n            if (callbackOnBack) {\n                callbackOnBack();\n            }\n        });\n    }\n    payment(options) {\n        const { userCode, data, callback, callbackOnBack } = options;\n        const type = this.getPaymentType(data);\n        const newOptions = {\n            type,\n            userCode,\n            data: Object.assign(Object.assign({}, data), { m_redirect_url: REDIRECT_URL }),\n            triggerCallback: this.triggerCallback,\n            redirectUrl: REDIRECT_URL,\n        };\n        this.addListenerInner(callback, callbackOnBack, type);\n        return IamportCapacitor.startIamportActivity(newOptions);\n    }\n    getPaymentType(data) {\n        const { pg, pay_method } = data;\n        if (pay_method === 'trans') {\n            if (pg.includes('html5_inicis')) {\n                return 'inicis';\n            }\n            if (pg.includes('nice')) {\n                return 'nice';\n            }\n        }\n        return 'payment';\n    }\n    certification(options) {\n        const { userCode, data, callback, callbackOnBack } = options;\n        const newOptions = {\n            type: 'certification',\n            userCode,\n            data: Object.assign(Object.assign({}, data), { m_redirect_url: REDIRECT_URL }),\n            triggerCallback: this.triggerCallback,\n            redirectUrl: REDIRECT_URL,\n        };\n        this.addListenerInner(callback, callbackOnBack);\n        return IamportCapacitor.startIamportActivity(newOptions);\n    }\n}\n//# sourceMappingURL=plugin.js.map","import { registerPlugin } from '@capacitor/core';\nconst IamportCapacitor = registerPlugin('IamportCapacitor', {\n    web: () => import('./web').then(m => new m.IamportCapacitorWeb()),\n});\nexport * from './definitions';\nexport * from './plugin';\nexport { IamportCapacitor };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nexport class IamportCapacitorWeb extends WebPlugin {\n    startIamportActivity(options) {\n        return new Promise(resolve => {\n            resolve(options);\n        });\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["Capacitor","registerPlugin","WebPlugin"],"mappings":"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"}