{"version":3,"file":"plugin.js","sources":["esm/plugin.js","esm/index.js","esm/web.js"],"sourcesContent":["// import { Device } from '@capacitor/device';\nimport { Capacitor } from '@capacitor/core';\nimport queryString from 'query-string';\nimport { IamportCapacitor } from './index';\n// const REDIRECT_URL = 'http://localhost/iamport';\nconst REDIRECT_URL = 'http://detectchangingwebview/iamport/capacitor';\nexport class IMP {\n    constructor() {\n        this.isCallbackCalled = false;\n        this.triggerCallback = `function(response) {\n      const query = [];\n      Object.keys(response).forEach(key => {\n        query.push(key + '=' + response[key]);\n      });\n\n      location.href = 'http://detectchangingwebview/iamport/capacitor?' + query.join('&');\n    }`;\n    }\n    addListenerInner(callback, callbackOnBack, type) {\n        IamportCapacitor.addListener('IMPOver', async ({ url }) => {\n            if (!this.isCallbackCalled) { // 콜백 중복 호출 방지\n                // const { platform } = await Device.getInfo();\n                const platform = Capacitor.getPlatform();\n                if (platform === 'ios' && type === 'inicis') {\n                    /**\n                     * IOS && 이니시스 && 실시간 계좌이체 예외처리\n                     * 리디렉션 URL: io.ionic.starter://?imp_uid=imp_048747651691%26merchant_uid=mid_1573712730635%26m_redirect_url=http%3A%2F%2Flocalhost%2Fiamport%3Fimp_uid%3Dimp_048747651691%26merchant_uid%3Dmid_15737127306352\n                    */\n                    const decodedUrl = decodeURIComponent(url);\n                    const extractedQuery = queryString.extract(decodedUrl);\n                    const parsedQuery = queryString.parse(extractedQuery);\n                    const { imp_uid, merchant_uid } = parsedQuery;\n                    const success = \"true\";\n                    const query = {\n                        success,\n                        imp_uid,\n                        merchant_uid: typeof merchant_uid === 'object'\n                            ? merchant_uid === null || merchant_uid === void 0 ? void 0 : merchant_uid[0]\n                            : merchant_uid,\n                    };\n                    callback(query);\n                }\n                else {\n                    const { query } = queryString.parseUrl(url);\n                    callback(query);\n                }\n                this.isCallbackCalled = true;\n            }\n        });\n        IamportCapacitor.addListener('IMPBack', async () => {\n            if (callbackOnBack) {\n                callbackOnBack();\n            }\n        });\n    }\n    payment(options) {\n        const { userCode, data, callback, callbackOnBack } = options;\n        const type = this.getPaymentType(data);\n        const newOptions = {\n            type,\n            userCode,\n            data: Object.assign(Object.assign({}, data), { m_redirect_url: REDIRECT_URL }),\n            triggerCallback: this.triggerCallback,\n            redirectUrl: REDIRECT_URL,\n        };\n        this.addListenerInner(callback, callbackOnBack, type);\n        return IamportCapacitor.startIamportActivity(newOptions);\n    }\n    getPaymentType(data) {\n        const { pg, pay_method } = data;\n        if (pay_method === 'trans') {\n            if (pg.includes('html5_inicis')) {\n                return 'inicis';\n            }\n            if (pg.includes('nice')) {\n                return 'nice';\n            }\n        }\n        return 'payment';\n    }\n    certification(options) {\n        const { userCode, data, callback, callbackOnBack } = options;\n        const newOptions = {\n            type: 'certification',\n            userCode,\n            data: Object.assign(Object.assign({}, data), { m_redirect_url: REDIRECT_URL }),\n            triggerCallback: this.triggerCallback,\n            redirectUrl: REDIRECT_URL,\n        };\n        this.addListenerInner(callback, callbackOnBack);\n        return IamportCapacitor.startIamportActivity(newOptions);\n    }\n}\n//# sourceMappingURL=plugin.js.map","import { registerPlugin } from '@capacitor/core';\nconst IamportCapacitor = registerPlugin('IamportCapacitor', {\n    web: () => import('./web').then(m => new m.IamportCapacitorWeb()),\n});\nexport * from './definitions';\nexport * from './plugin';\nexport { IamportCapacitor };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nexport class IamportCapacitorWeb extends WebPlugin {\n    startIamportActivity(options) {\n        return new Promise(resolve => {\n            resolve(options);\n        });\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["Capacitor","registerPlugin","WebPlugin"],"mappings":"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"}